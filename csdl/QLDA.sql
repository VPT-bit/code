CREATE DATABASE QLDA
GO
USE QLDA
GO

CREATE TABLE PHONGBAN(
MAPB VARCHAR(5) CONSTRAINT PK_PHONGBAN PRIMARY KEY,
TENPB NVARCHAR(50),
TRUONGPHONG VARCHAR(5),
NG_NHANCHUC DATE
)

CREATE TABLE NHANVIEN (
MANV VARCHAR(5) CONSTRAINT PK_NHANVIEN PRIMARY KEY,
HONV NVARCHAR(20),
TENLOT NVARCHAR(20),
TENNV NVARCHAR(10),
NGAYSINH DATE,
DIACHI NVARCHAR(100),
PHAI VARCHAR(5),
LUONG DECIMAL(10,2),
MAPB VARCHAR(5) CONSTRAINT FK_NHANVIEN FOREIGN KEY REFERENCES PHONGBAN(MAPB),
)

CREATE TABLE THANNHAN(
MANV VARCHAR(5) CONSTRAINT FK_THANNHAN FOREIGN KEY REFERENCES NHANVIEN(MANV),
TENTN NVARCHAR(30),
PHAI VARCHAR(5),
NGAYSINH DATE,
QUANHE NVARCHAR(20),
CONSTRAINT PK_THANNHAN PRIMARY KEY (MANV, TENTN),
)

CREATE TABLE DDIEMPB(
MAPB VARCHAR(5) CONSTRAINT FK_DDIEMPB FOREIGN KEY REFERENCES PHONGBAN(MAPB),
DIADIEM NVARCHAR(100),
CONSTRAINT PK_DDIEMPB PRIMARY KEY (MAPB, DIADIEM)
)

CREATE TABLE DEAN(
MADA VARCHAR(5) CONSTRAINT PK_DEAN PRIMARY KEY,
TENDA NVARCHAR(50),
DDIEM_DA NVARCHAR(100),
MAPB VARCHAR(5) CONSTRAINT FK_DEAN FOREIGN KEY REFERENCES PHONGBAN(MAPB)
)

CREATE TABLE PHANCONG(
MANV VARCHAR(5) CONSTRAINT FK1_PHANCONG FOREIGN KEY REFERENCES NHANVIEN(MANV),
MADA VARCHAR(5) CONSTRAINT FK2_PHANCONG FOREIGN KEY REFERENCES DEAN(MADA),
THOIGIAN DECIMAL(5,1),
CONSTRAINT PK_PHANCONG PRIMARY KEY (MANV, MADA)
)

INSERT INTO PHONGBAN
VALUES ('P1', N'QUANLY', 'NV5', '6/19/2016'),
('P2', N'DIEUHANH', 'NV8', '1/1/2018'),
('P3', N'NGHIENCUU', 'NV2', '5/22/2017')

INSERT INTO NHANVIEN
VALUES ('NV1', N'DINH', N'BA', N'TIEN', '1/9/1985', N'731 TRAN HUNG DAO, Q1, TPHCM', 'NAM', 30000, 'P3'),
('NV2', N'VO', N'THANH', N'TUNG', '12/8/1975', N'638 TRAN HUNG DAO', 'NAM', 40000, 'P3'),
('NV3', N'TRAN', N'THANH', N'TAM', '7/31/1982', N'853 MAI THI LUU, Q1, TPHCM', 'NAM', 25000, 'P2'),
('NV4', N'VO', N'MANH', N'HUNG', '9/15/1972', N'975 BA RIA, VUNG TAU', 'NAM', 38000, 'P2'),
('NV5', N'LE', N'NGOC', N'QUYEN', '10/10/1987', N'450 TRUNG VUONG, HA NOI', 'NU', 55000, 'P1'),
('NV6', N'TRAN', N'MINH', N'KHANG', '6/24/1982', N'TRAN BINH TRONG, TPHCM', 'NAM', 58000, 'P1'),
('NV7', N'LE', N'THI', N'NHAN', '6/20/1981', N'291 HO VAN HUC, QPN, TPHCM', 'NU', 43000, 'P3'),
('NV8', N'TRAN', N'HONG', N'QUANG', '3/29/1979', N'980 LE HONG PHONG, Q10, TPHCM', 'NAM', 25000, 'P2'),
('NV9', N'BUI', N'THUY', N'VU', '7/19/1979', N'332 NGUYEN THAI HOC, Q1, TPHCM', 'NU', 25000, 'P1')

INSERT INTO DEAN
VALUES ('DA1', N'SAN PHAM X', N'VUNG TAU', 'P3'),
('DA2', N'SAN PHAM Y', N'NHA TRANG', 'P3'),
('DA3', N'SAN PHAM Z', N'TPHCM', 'P3'),
('DA4', N'TIN HOC HOA', N'HA NOI', 'P2'),
('DA5', N'CAP QUANG', N'TPHCM', 'P1'),
('DA6', N'DAO TAO', N'HA NOI', 'P2')

INSERT INTO DDIEMPB
VALUES ('P1', N'TPHCM'),
('P2', N'HA NOI'),
('P3', N'NHA TRANG'),
('P3', N'TPHCM'),
('P3', N'VUNG TAU')

INSERT INTO PHANCONG
VALUES ('NV1', 'DA1', 32.5), ('NV1', 'DA2', 7.5), ('NV1', 'DA3', 10),
('NV2', 'DA3', 40), ('NV2', 'DA4', 20), ('NV2', 'DA5', 20),
('NV3', 'DA1', 20),('NV3', 'DA2', 20),
('NV4', 'DA3', 10),
('NV5', 'DA4', 10), ('NV5', 'DA5', 10),
('NV7', 'DA6', 30),
('NV8', 'DA4', 10), ('NV8', 'DA6', 20),
('NV9', 'DA4', 15)

INSERT INTO THANNHAN
VALUES ('NV1', N'DINH BA KIEN', 'NAM', '7/15/1995', N'CON TRAI'),
('NV1', N'NGUYEN THANH THAO', 'NU', '4/8/1988', N'VỢ'),
('NV2', N'VO THANH SON', 'NAM', '9/23/1950', N'CHA'),
('NV3', N'LE THI HUONG', 'NU', '1/9/1984', N'VỢ'),
('NV3', N'TRAN LE NGOC HOA', 'NU', '9/12/2017', N'CON GÁI'),
('NV6', N'TRAN MINH AN', 'NAM', '8/5/1980', N'ANH TRAI'),
('NV7', N'LE THI NGAN', 'NU', '6/7/1980', N'EM GÁI'),
('NV9', N'TRAN QUOC VUONG', 'NAM', '5/5/1975', N'CHỒNG')

--Bài 2 câu 19: Đối với từng đề án, cho biết tên nhân viên, tên đề án, số giờ làm việc nhiều nhất
select NV.HONV, NV.TENLOT, NV.TENNV, DA.TENDA, PC.THOIGIAN
from PHANCONG PC
join NHANVIEN NV on PC.MANV=NV.MANV
join DEAN DA on PC.MADA=DA.MADA
where PC.THOIGIAN=(
	select max(PC1.THOIGIAN)
	from PHANCONG PC1
	where PC1.MADA=PC.MADA
)

-- Bài 2 / Câu 33
insert into PHANCONG
select 'NV3', MADA, null
from PHANCONG
where MADA not in(
	select distinct MADA
	from PHANCONG
	where MANV='NV3'
)

